"use strict";sap.ui.define(["sap/ui/base/ManagedObject","../dialog/ODataMessageHandler","sap/base/Log","../TableSelector","sap/ui/model/json/JSONModel","sap/ui/core/Fragment"],function(e,t,s,a,o,n){"use strict";function r(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const i=r(t);const l=r(a);const c=e.extend("cc.spreadsheetimporter.v0_26_1.OData",{constructor:function t(s,a){e.prototype.constructor.call(this);this._tables=[];this.UI5MinorVersion=s;this.odataMessageHandler=new i(a);this.spreadsheetUploadController=a},callOdata:async function e(t,a,o){const n=o.component;const r=o.tableObject;const i=o.payloadArray;const l=o.binding;const c=o.context;try{const e=r.getModel();await this.createBusyDialog(o);const s=this.processPayloadArray(n.getBatchSize(),i);this.busyDialog.getModel("busyModel").setProperty("/progressText",`0/${i.length}`);let a=0;let g=0;for(const t of s){for(const s of t){n.fireChangeBeforeCreate({payload:s});this.createAsync(e,l,s)}await this.submitChanges(e);let s=await this.checkForErrors(e,l,n.getShowBackendErrorMessages());if(s){this.busyDialog.close();break}else{await this.waitForCreation()}if(n.getActivateDraft()&&!s){await this.waitForDraft()}this.resetContexts();a=a+t.length/i.length*100;g=g+t.length;this.busyDialog.getModel("busyModel").setProperty("/progressPercent",a);this.busyDialog.getModel("busyModel").setProperty("/progressText",`${g} / ${i.length}`)}o.refreshBinding(c,l,r.getId());this.busyDialog.close();t()}catch(e){this.busyDialog.close();this.resetContexts();s.error("Error while calling the odata service",e,"SpreadsheetUpload: callOdata");a(e)}},getBinding:function e(t){if(t.getMetadata().getName()==="sap.m.Table"||t.getMetadata().getName()==="sap.m.List"){return t.getBinding("items")}if(t.getMetadata().getName()==="sap.ui.table.Table"){return t.getBinding("rows")}},_getActionName:function e(t,s){var a=t.getModel(),o=a.getMetaModel(),n=o.getMetaPath(t.getPath());return o.getObject("".concat(n,"@com.sap.vocabularies.Common.v1.DraftRoot/").concat(s))},processPayloadArray:function e(t,s){if(t>0){let e=[];const a=Math.ceil(s.length/t);const o=Math.ceil(s.length/a);for(let t=0;t<s.length;t+=o){e.push(s.slice(t,t+o))}return e}else{return[s]}},getTableObject:async function e(t,s,a){if(!t){this.tables=s.findAggregatedObjects(true,function(e){return e.isA("sap.m.Table")||e.isA("sap.ui.table.Table")});if(this.tables.length>1&&!a.component.getUseTableSelector()){throw new Error("Found more than one table on Object Page.\n Please specify table in option 'tableId'")}else if(this.tables.length>1&&a.component.getUseTableSelector()){const e=new l(s);let t;try{t=await e.chooseTable()}catch(e){throw new Error(a.util.geti18nText("tableSelectorDialogCancel"))}return t}else if(this.tables.length===0){throw new Error("Found more than one table on Object Page.\n Please specify table in option 'tableId'")}else{return this.tables[0]}}else{return s.byId(t)}},createBusyDialog:async function e(t){const s=new o({progressPercent:0,progressText:"0"});if(!this.busyDialog){this.busyDialog=await n.load({name:"cc.spreadsheetimporter.v0_26_1.fragment.BusyDialogProgress",controller:this})}this.busyDialog.setModel(s,"busyModel");this.busyDialog.setModel(t.component.getModel("device"),"device");this.busyDialog.setModel(t.component.getModel("i18n"),"i18n");this.busyDialog.open()},get tables(){return this._tables},set tables(e){this._tables=e}});return c});
//# sourceMappingURL=OData.js.map