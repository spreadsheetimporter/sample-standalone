"use strict";sap.ui.define(["sap/ui/base/ManagedObject","./Util","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/ui/core/library","sap/base/Log","../enums"],function(e,t,s,o,r,a,n){"use strict";function i(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const l=i(t);const d=r["MessageType"];const u=n["CustomMessageTypes"];const c=e.extend("cc.spreadsheetimporter.v0_26_1.MessageHandler",{constructor:function t(s){e.prototype.constructor.call(this);this.messages=[];this.messages=[];this.spreadsheetUploadController=s},setMessages:function e(t){this.messages=t},addArrayToMessages:function e(t){a.debug("addArrayToMessages",undefined,"SpreadsheetUpload: MessageHandler",()=>this.spreadsheetUploadController.component.logger.returnObject(t));this.messages=this.messages.concat(t)},addMessageToMessages:function e(t){a.debug("addMessageToMessages",undefined,"SpreadsheetUpload: MessageHandler",()=>this.spreadsheetUploadController.component.logger.returnObject(t));this.messages.push(t)},getMessages:function e(){return this.messages},checkMandatoryColumns:function e(t,s,o,r,a){const n=[...new Set([...o,...r])];this.checkMandatoryFields(t,n,a)},checkMandatoryFields:function e(t,s,o){if(!s){return}for(const e of s){const s=o.get(e)?.label;if(!s){a.error(`Mandatory Field ${e} not found for checking mandatory fields`,undefined,"SpreadsheetUpload: MessageHandler");continue}for(const[o,r]of t.entries()){const t=l.getValueFromRow(r,s,e,this.spreadsheetUploadController.component.getFieldMatchType());const a={title:this.spreadsheetUploadController.util.geti18nText("mandatoryFieldNotFilled",[s]),type:u.MandatoryFieldNotFilled,row:o+2,counter:1,ui5type:d.Error};if(!t||t.rawValue===""||t.rawValue===undefined){this.addMessageToMessages(a)}}}},checkFormat:function e(t){for(const[e,s]of t.entries()){Object.values(s).forEach(t=>{let{sheetDataType:s,format:o,rawValue:r,formattedValue:a}=t;if(s==="n"&&o!=="General"&&r!==Number(a)){const t={title:"Format",type:u.Formatting,row:e+2,counter:1,ui5type:d.Warning,rawValue:r,formattedValue:a};this.addMessageToMessages(t)}})}},checkColumnNames:function e(t,s,o){for(let e=0;e<t.length;e++){const r=t[e];let a=false;for(const[e,t]of o){if(s==="label"){if(t.label===r){a=true;break}}if(s==="labelTypeBrackets"){if(r.includes(`[${e}]`)){a=true;break}}}if(!a){const e={title:this.spreadsheetUploadController.util.geti18nText("columnNotFound",[r]),type:u.ColumnNotFound,counter:1,ui5type:d.Error};this.addMessageToMessages(e)}}},checkKeyColumns:function e(t,s,o){const r=[];for(let e=0;e<s.length;e++){const a=s[e];let n=false;for(const e in t){if(t[e].includes(`[${a}]`)){n=true;r.push(a);break}}if(!n){const e=o.get(a)?.label?o.get(a).label:a;const t={title:this.spreadsheetUploadController.util.geti18nText("keyColumnNotFound",[e]),type:u.ColumnNotFound,counter:1,ui5type:d.Error};this.addMessageToMessages(t)}}return r},areMessagesPresent:function e(){if(this.messages.some(e=>e.counter>0)){return true}return false},displayMessages:async function e(){if(!this.messageDialog){this.messageDialog=await s.load({name:"cc.spreadsheetimporter.v0_26_1.fragment.MessagesDialog",type:"XML",controller:this})}this.messageDialog.setModel(this.spreadsheetUploadController.componentI18n,"i18n");this.messageDialog.setModel(new o,"messages");const t=this.groupMessages(this.messages);const r=this.sortMessagesByTitle(t);a.debug("sortedMessagesGrouped",undefined,"SpreadsheetUpload: MessageHandler",()=>this.spreadsheetUploadController.component.logger.returnObject({sortedMessagesGrouped:r}));this.messageDialog.getModel("messages").setData(r);const n=this.getWorstType(r);const i=new o({strict:this.spreadsheetUploadController.component.getStrict(),dialogState:n});this.messageDialog.setModel(i,"info");this.messageDialog.open()},groupMessages:function e(t){const s=t.filter(e=>e.counter!==0);const o=s.filter(e=>e.type.group===true);const r=o.reduce((e,t)=>{let s="";if(!e[t.title]){e[t.title]=[]}if(t.rawValue&&t.formattedValue){s=this.spreadsheetUploadController.util.geti18nText("errorInRowWithValueFormatted",[t.row,t.formattedValue,t.rawValue])}else if(t.rawValue){s=this.spreadsheetUploadController.util.geti18nText("errorInRowWithValue",[t.row,t.rawValue])}else{s=this.spreadsheetUploadController.util.geti18nText("errorInRow",[t.row])}e[t.title].push(s);return e},{});const a=[];for(const e in r){const s=t.find(t=>t.title===e)?.ui5type||"";a.push({title:e,description:r[e].join("\n"),ui5type:s})}const n=a.concat(s.filter(e=>e.type.group===false));return n},onCloseMessageDialog:function e(){this.messageDialog.close();this.spreadsheetUploadController.resetContent()},onContinue:function e(){this.messageDialog.close();const t=this.spreadsheetUploadController.getSpreadsheetUploadDialog();const s=this.spreadsheetUploadController.payloadArray.length;t.getModel("info").setProperty("/dataRows",s)},sortMessagesByTitle:function e(t){return t.sort((e,t)=>{if(e.title<t.title){return-1}if(e.title>t.title){return 1}return 0})},getWorstType:function e(t){let s=d.None;const o={[d.None]:0,[d.Information]:1,[d.Success]:2,[d.Warning]:3,[d.Error]:4};for(const e of t){if(o[e.ui5type]>o[s]){s=e.ui5type}}return s}});return c});
//# sourceMappingURL=MessageHandler.js.map